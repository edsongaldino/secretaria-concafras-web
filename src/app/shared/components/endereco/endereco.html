<div class="endereco-form" [formGroup]="formGroup">

  <!-- CEP | Número | Complemento -->
  <div class="form-grid grid-3" *ngIf="isBR()">
    <div>
      <mat-form-field appearance="outline">
        <mat-label>CEP</mat-label>
        <input matInput formControlName="cep" mask="00000-000" (blur)="buscarCep()" placeholder="00000-000" />
      </mat-form-field>
    </div>

    <div>
      <mat-form-field appearance="outline">
        <mat-label>Número</mat-label>
        <input matInput formControlName="numero" />
      </mat-form-field>
    </div>

    <div>
      <mat-form-field appearance="outline">
        <mat-label>Complemento</mat-label>
        <input matInput formControlName="complemento" />
      </mat-form-field>
    </div>
  </div>

  <!-- Logradouro (2 colunas) | Bairro (1 coluna) -->
  <div class="form-grid grid-3">
    <div class="span-2">
      <mat-form-field appearance="outline">
        <mat-label>Logradouro</mat-label>
        <input matInput formControlName="logradouro" />
      </mat-form-field>
    </div>

    <div>
      <mat-form-field appearance="outline">
        <mat-label>Bairro</mat-label>
        <input matInput formControlName="bairro" />
      </mat-form-field>
    </div>
  </div>

  <!-- País | Estado/Província | Cidade (sempre na mesma linha) -->
  <div class="form-grid grid-3">
    <!-- País -->
    <div>
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>País</mat-label>
        <mat-select formControlName="countryCode" (selectionChange)="onPaisChange()">
          <mat-option *ngFor="let p of paises; trackBy: trackPais" [value]="p.iso2">
            {{ p.nome }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Coluna 2: Estado (BR) | Província (não-BR) -->
    <div>
      <ng-container *ngIf="isBR(); else provinciaInput">
        <mat-form-field appearance="outline">
          <mat-label>Estado (UF)</mat-label>
          <!-- mantém compat: 'estado' = UF -->
          <mat-select formControlName="estado" (selectionChange)="onEstadoChange()">
            <mat-option value="">Selecione</mat-option>
            <mat-option *ngFor="let e of estados; trackBy: trackEstado" [value]="e.uf">
              {{ e.nome }} ({{ e.uf }})
            </mat-option>
          </mat-select>
        </mat-form-field>
      </ng-container>
      <ng-template #provinciaInput>
        <mat-form-field appearance="outline">
          <mat-label>Estado/Província</mat-label>
          <input matInput formControlName="estadoProvincia" />
        </mat-form-field>
      </ng-template>
    </div>

    <!-- Coluna 3: Cidade (BR select) | Cidade (não-BR texto) -->
    <div>
      <ng-container *ngIf="isBR(); else cidadeTextoInput">
        <mat-form-field appearance="outline">
          <mat-label>Cidade</mat-label>
          <!-- mantém compat: 'cidade' = nome -->
          <mat-select formControlName="cidade" (selectionChange)="onCidadeChange()">
            <mat-option value="">Selecione</mat-option>
            <mat-option *ngFor="let c of cidades; trackBy: trackCidade" [value]="c.nome">
              {{ c.nome }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </ng-container>
      <ng-template #cidadeTextoInput>
        <mat-form-field appearance="outline">
          <mat-label>Cidade</mat-label>
          <input matInput formControlName="cidadeTexto" />
        </mat-form-field>
      </ng-template>
    </div>
  </div>

</div>
